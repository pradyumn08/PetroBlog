<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waves in Rod Strings: The Bergeron Method Explained</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            font-family: 'Arial', sans-serif;
            color: #2c3e50;
        }
        h1 {
            font-size: 2.2em;
            margin-bottom: 0.5em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            font-size: 1.8em;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        h3 {
            font-size: 1.3em;
            margin-top: 1.2em;
        }
        p {
            margin-bottom: 1.2em;
        }
        .quote {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            font-style: italic;
            margin: 20px 0;
        }
        .note {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 5px solid #3498db;
            margin: 20px 0;
        }
        .simulation-container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        canvas {
            width: 100%;
            height: 400px;
            margin: 20px 0;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #2980b9;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .slider-container span {
            min-width: 50px;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px auto;
        }
        .figure {
            text-align: center;
            margin: 20px 0;
        }
        .figure img {
            max-width: 100%;
        }
        .figure-caption {
            font-style: italic;
            color: #666;
            margin-top: 10px;
        }
        code {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Waves in Rod Strings: The Bergeron Method Simplified</h1>

    
    <p>Hello there, curious minds! Today I want to talk about something that might sound complex but is actually quite beautiful when you break it down: how waves travel through rods, particularly in oil well pumping systems. This is based on a fascinating paper by A. Khodabandeh and S. Miska that introduces a simple yet powerful method for predicting how sucker-rod pumping systems behave.</p>
    
    <p>Now, you might be wondering, "What's a sucker-rod pumping system?" Well, it's the most common way to artificially lift oil from wells when there's not enough natural pressure to bring it to the surface. Picture a giant seesaw (called a "pumping unit") on the surface, connected to a long string of rods that go thousands of feet down into the well. These rods move up and down to operate a pump at the bottom that brings oil to the surface.</p>
    
    <h2>The Problem: Waves in Rods</h2>
    
    <p>Here's the interesting part: when the surface unit starts moving these rods, they don't just move as a solid unit. Instead, waves of force and motion travel through them, just like when you shake one end of a rope and see a wave travel to the other end. Understanding these waves is crucial for designing efficient pumping systems.</p>
    
    <p>Traditionally, engineers have used a complex mathematical equation called the "wave equation" to model this behavior:</p>
    
    <p>\[\frac{\partial^{2}u(x,t)}{\partial t^{2}}=a^{2}\frac{\partial^{2}u(x,t)}{\partial x^{2}}-c\frac{\partial u(x,t)}{\partial t}\]</p>
    
    <p>This is a second-order partial differential equation, and while it's mathematically elegant, it can be challenging to solve and doesn't provide intuitive understanding for many engineers.</p>
    
    <h2>The Bergeron Method: A First-Principles Approach</h2>
    
    <p>The authors introduce a simpler approach called the "Bergeron method" (originally developed for water hammer problems in hydraulics). Instead of solving that complex equation, we can use two simple algebraic equations:</p>
    
    <p>\[F a_{t}–F b_{t-1}~=~S_{r}(V a_{t}–V b_{t-1})\]</p>
    
    <p>and</p>
    
    <p>\[F b_{_t}{-}F a_{_{t-1}}=-S_{_r}(V b_{_t}{-}V a_{_{t-1}})\]</p>
    
    <p>Where:</p>
    <ul>
        <li>\(F\) represents forces at different points</li>
        <li>\(V\) represents velocities</li>
        <li>\(S_r\) is something called the "characteristic impedance" of the rod</li>
        <li>The subscripts \(a\) and \(b\) represent the top and bottom of a rod segment</li>
        <li>The subscript \(t\) represents time steps</li>
    </ul>
    
    <p>The characteristic impedance \(S_r\) is calculated as:</p>
    
    <p>\[S_{r}=\frac{a\rho A}{g}\]</p>
    
    <p>Where:</p>
    <ul>
        <li>\(a\) is the wave velocity in the rod: \(a=\sqrt{\frac{g E}{\rho}}\)</li>
        <li>\(\rho\) is the density of the rod material</li>
        <li>\(A\) is the cross-sectional area of the rod</li>
        <li>\(g\) is gravitational acceleration</li>
        <li>\(E\) is Young's modulus (a measure of the rod's stiffness)</li>
    </ul>
    
    <h2>Understanding the Bergeron Method: An Imaginary Observer</h2>
    
    <p>Here's where I find this approach particularly elegant. Instead of thinking about complex wave equations, imagine an observer traveling along the rod at the speed of sound in the material. This observer measures forces and velocities as they go.</p>
    
    <p>The first equation describes what happens when the observer moves upward (opposite to the rod's motion), and the second equation describes what happens when they move downward (in the same direction as the rod).</p>
    
    <p>The time unit in these equations is defined as:</p>
    
    <p>\[t~=~\frac{L}{a}\]</p>
    
    <p>Which is simply the time it takes for a wave to travel the length \(L\) of the rod segment at velocity \(a\).</p>
    
    <h2>Let's Visualize This!</h2>
    
    <div class="simulation-container">
        <h3>Rod Wave Propagation Simulator</h3>
        <p>This interactive simulation shows how waves propagate through a rod when you apply a sudden change in velocity at one end. Adjust the parameters to see how they affect the wave behavior.</p>
        
        <div class="controls">
            <div class="control-group">
                <label for="velocity-change">Velocity Change (V*):</label>
                <div class="slider-container">
                    <input type="range" id="velocity-change" min="0.1" max="2" step="0.1" value="1">
                    <span id="velocity-value">1.0</span>
                </div>
            </div>
            
            <div class="control-group">
                <label for="damping">Damping Factor (K/Sr):</label>
                <div class="slider-container">
                    <input type="range" id="damping" min="0" max="2" step="0.1" value="0.5">
                    <span id="damping-value">0.5</span>
                </div>
            </div>
            
            <div class="control-group">
                <button id="reset-sim">Reset Simulation</button>
            </div>
        </div>
        
        <div>
            <canvas id="wave-chart"></canvas>
        </div>
        
        <div class="note">
            <p><strong>How to interpret:</strong> The blue line shows the force at the top of the rod (Fa), and the red line shows the force at the bottom (Fb). Notice how the wave travels back and forth, and how damping affects the amplitude over time.</p>
        </div>
    </div>
    
    <h2>Real-World Application: The Dynamometer Card</h2>
    
    <p>In the oil industry, engineers use something called a "dynamometer card" to diagnose the performance of pumping systems. It's essentially a plot of the load (force) at the surface versus the position of the rod. The shape of this card can tell experienced engineers a lot about what's happening thousands of feet below the surface.</p>
    
    <p>Using the Bergeron method, we can generate these cards computationally and compare them with actual measurements to validate our model. The authors did exactly this and found good agreement between their simulated cards and real-world measurements.</p>
    
    <div class="simulation-container">
        <h3>Dynamometer Card Generator</h3>
        <p>This interactive tool generates a dynamometer card based on the Bergeron method. Adjust the parameters to see how they affect the card shape.</p>
        
        <div class="controls">
            <div class="control-group">
                <label for="stroke-length">Stroke Length (inches):</label>
                <div class="slider-container">
                    <input type="range" id="stroke-length" min="20" max="100" step="5" value="60">
                    <span id="stroke-length-value">60</span>
                </div>
            </div>
            
            <div class="control-group">
                <label for="rod-length">Rod Length (feet):</label>
                <div class="slider-container">
                    <input type="range" id="rod-length" min="500" max="5000" step="500" value="2000">
                    <span id="rod-length-value">2000</span>
                </div>
            </div>
            
            <div class="control-group">
                <label for="fluid-level">Fluid Level (feet):</label>
                <div class="slider-container">
                    <input type="range" id="fluid-level" min="500" max="4000" step="500" value="1500">
                    <span id="fluid-level-value">1500</span>
                </div>
            </div>
            
            <div class="control-group">
                <button id="generate-card">Generate Card</button>
            </div>
        </div>
        
        <div>
            <canvas id="dynamometer-chart"></canvas>
        </div>
        
        <div class="note">
            <p><strong>How to interpret:</strong> This chart shows the relationship between position (x-axis) and load (y-axis) at the polished rod (the top of the rod string). The shape of this curve is called a "dynamometer card" and is used by petroleum engineers to diagnose pumping system performance.</p>
        </div>
    </div>
    
    <h2>The Mathematical Details: For Those Who Want to Dig Deeper</h2>
    
    <p>Let's derive the Bergeron equations from first principles. Consider an elastic rod moving with velocity \(V_0\) and subjected to an internal force \(P_0\). If we apply an external force \(P^*\) at one end, the velocity at that end changes to \(V^*\).</p>
    
    <p>This change in velocity propagates along the rod at the acoustic velocity \(a\). After time \(\Delta t\), the wave front has traveled a distance \(a\Delta t\). The momentum of this section of rod changes from \((\rho A a)V_0\) to \((\rho A a)V^*\).</p>
    
    <p>By Newton's second law, the change in momentum equals the impulse of the applied force:</p>
    
    <p>\[(\rho a A)V^{*}-(\rho a A)V_{o}~=~-(P_{o}+P^{*})+P_{o}\]</p>
    
    <p>Simplifying:</p>
    
    <p>\[P^{*}~=~-(\rho a A)(V^{*}-V_o)\]</p>
    
    <p>If we define the characteristic impedance \(S_r = \frac{\rho a A}{g}\), and consider different points along the rod at different time steps, we get the Bergeron equations:</p>
    
    <p>\[F a_{t}–F b_{t-1}~=~S_{r}(V a_{t}–V b_{t-1})\]</p>
    
    <p>\[F b_{_t}{-}F a_{_{t-1}}=-S_{_r}(V b_{_t}{-}V a_{_{t-1}})\]</p>
    
    <p>To account for energy dissipation (damping), we add a damping force term:</p>
    
    <p>\[F_{d}=\frac{\pi a\nu}{2L g}\rho A\Delta x V_{t}\]</p>
    
    <p>Where \(\nu\) is a dimensionless damping factor.</p>
    
    <h2>Why This Matters: Practical Applications</h2>
    
    <p>This approach has several advantages:</p>
    
    <ol>
        <li><strong>Simplicity:</strong> Engineers don't need to solve complex differential equations.</li>
        <li><strong>Efficiency:</strong> The computations are faster and easier to implement.</li>
        <li><strong>Flexibility:</strong> It works for any composition of rods, regardless of size or material properties.</li>
        <li><strong>Accuracy:</strong> The results match well with real-world measurements.</li>
    </ol>
    
    <p>By accurately predicting the behavior of sucker-rod pumping systems, engineers can design more efficient systems, diagnose problems more effectively, and ultimately extract oil more economically.</p>
    
    <h2>Conclusion: The Beauty of Simplification</h2>
    
    <p>What I find most beautiful about this approach is how it takes a complex problem (wave propagation in rods described by partial differential equations) and reduces it to something much more intuitive: an observer traveling along the rod, measuring forces and velocities.</p>
    
    
    <p>Until next time, keep looking for the simple patterns in complex systems!</p>
    

    <script>
        // Wave propagation simulation
        let waveChart;
        let timePoints = [];
        let forcePointsA = [];
        let forcePointsB = [];
        let simulationTime = 0;
        let animationId;
        
        function initWaveChart() {
            const ctx = document.getElementById('wave-chart').getContext('2d');
            
            waveChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timePoints,
                    datasets: [
                        {
                            label: 'Force at Top (Fa)',
                            data: forcePointsA,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            tension: 0.1,
                            fill: false
                        },
                        {
                            label: 'Force at Bottom (Fb)',
                            data: forcePointsB,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            tension: 0.1,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time (Bergeron Units)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Force (normalized)'
                            }
                        }
                    }
                }
            });
        }
        
        function updateWaveSimulation() {
            const velocityChange = parseFloat(document.getElementById('velocity-change').value);
            const damping = parseFloat(document.getElementById('damping').value);
            
            // Update display values
            document.getElementById('velocity-value').textContent = velocityChange.toFixed(1);
            document.getElementById('damping-value').textContent = damping.toFixed(1);
            
            // Clear previous data
            timePoints = [];
            forcePointsA = [];
            forcePointsB = [];
            simulationTime = 0;
            
            // Initialize with zero values
            timePoints.push(0);
            forcePointsA.push(0);
            forcePointsB.push(0);
            
            // Start the animation
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            animateWave(velocityChange, damping);
        }
        
        function animateWave(velocityChange, dampingRatio) {
            // Calculate the next step in the wave propagation
            simulationTime += 0.5;
            timePoints.push(simulationTime);
            
            // Simple model of wave propagation with the Bergeron method
            const Sr = 1; // Normalized characteristic impedance
            
            let Fa = 0;
            let Fb = 0;
            let Va = 0;
            let Vb = 0;
            
            if (simulationTime <= 0.5) {
                // Initial step - velocity change at top
                Va = velocityChange;
                Fa = Sr * Va;
                Fb = 0;
                Vb = 0;
            } else {
                // Previous values (from the last two points)
                const prevFa = forcePointsA[forcePointsA.length - 1];
                const prevFb = forcePointsB[forcePointsB.length - 1];
                
                // Apply the Bergeron equations with damping
                if (Math.floor(simulationTime) % 2 === 1) {
                    // Wave traveling down
                    Va = velocityChange; // Boundary condition at top
                    Fb = prevFa - Sr * (Va - prevFb / Sr) * Math.exp(-dampingRatio * 0.5);
                    Vb = Fb / Sr;
                    Fa = Sr * Va;
                } else {
                    // Wave traveling up
                    Vb = 0; // Boundary condition at bottom (if damping = 0)
                    if (dampingRatio > 0) {
                        Vb = prevFb / (Sr + dampingRatio * Sr); // With damping
                    }
                    Fb = Sr * Vb;
                    Fa = prevFb + Sr * (Vb - prevFa / Sr) * Math.exp(-dampingRatio * 0.5);
                    Va = Fa / Sr;
                }
            }
            
            forcePointsA.push(Fa);
            forcePointsB.push(Fb);
            
            // Update the chart
            waveChart.update();
            
            // Continue the animation if we haven't reached the end
            if (simulationTime < 20) {
                animationId = requestAnimationFrame(() => animateWave(velocityChange, dampingRatio));
            }
        }
        
        // Dynamometer card simulation
        let dynamometerChart;
        
        function initDynamometerChart() {
            const ctx = document.getElementById('dynamometer-chart').getContext('2d');
            
            dynamometerChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Dynamometer Card',
                        data: [],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        showLine: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Position (inches)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Load (lbs)'
                            }
                        }
                    }
                }
            });
        }
        
        function generateDynamometerCard() {
            const strokeLength = parseFloat(document.getElementById('stroke-length').value);
            const rodLength = parseFloat(document.getElementById('rod-length').value);
            const fluidLevel = parseFloat(document.getElementById('fluid-level').value);
            
            // Update display values
            document.getElementById('stroke-length-value').textContent = strokeLength;
            document.getElementById('rod-length-value').textContent = rodLength;
            document.getElementById('fluid-level-value').textContent = fluidLevel;
            
            // Generate a synthetic dynamometer card
            const cardPoints = [];
            const numPoints = 100;
            
            // Basic weight of the rod
            const rodDiameter = 0.75; // inches
            const rodWeight = 1.5; // lbs/ft
            const totalRodWeight = rodWeight * rodLength;
            
            // Fluid weight (simplified)
            const fluidDensity = 0.33; // lbs/ft per inch^2 of plunger
            const plungerDiameter = 1.5; // inches
            const plungerArea = Math.PI * (plungerDiameter/2) * (plungerDiameter/2);
            const fluidWeight = fluidDensity * fluidLevel * plungerArea;
            
            // Generate points for a complete cycle
            for (let i = 0; i < numPoints; i++) {
                const angle = (i / numPoints) * 2 * Math.PI;
                const position = (strokeLength / 2) * (1 - Math.cos(angle));
                
                // Calculate load based on position
                // Upstroke: rod weight + fluid weight + dynamic effects
                // Downstroke: rod weight - fluid friction + dynamic effects
                let load;
                
                if (angle < Math.PI) {
                    // Upstroke
                    const dynamicFactor = 1 + 0.2 * Math.sin(angle * 2) * (rodLength / 1000);
                    load = (totalRodWeight + fluidWeight) * dynamicFactor;
                } else {
                    // Downstroke
                    const dynamicFactor = 1 + 0.1 * Math.sin(angle * 2) * (rodLength / 1000);
                    load = totalRodWeight * dynamicFactor - fluidWeight * 0.2;
                }
                
                // Add some variation based on rod length and fluid level
                load += (rodLength / fluidLevel) * 50 * Math.sin(angle * 3);
                
                cardPoints.push({x: position, y: load});
            }
            
            // Update the chart
            dynamometerChart.data.datasets[0].data = cardPoints;
            dynamometerChart.update();
        }
        
        // Initialize everything when the page loads
        window.onload = function() {
            initWaveChart();
            initDynamometerChart();
            
            // Add event listeners
            document.getElementById('velocity-change').addEventListener('input', updateWaveSimulation);
            document.getElementById('damping').addEventListener('input', updateWaveSimulation);
            document.getElementById('reset-sim').addEventListener('click', updateWaveSimulation);
            
            document.getElementById('generate-card').addEventListener('click', generateDynamometerCard);
            
            // Start the simulations
            updateWaveSimulation();
            generateDynamometerCard();
        };
    </script>
</body>
