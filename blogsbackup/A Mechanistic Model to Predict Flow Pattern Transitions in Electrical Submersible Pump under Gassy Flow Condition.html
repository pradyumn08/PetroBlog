<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding Flow Patterns in Electrical Submersible Pumps</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            font-size: 2.2em;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        h2 {
            font-size: 1.8em;
            margin-top: 30px;
        }
        h3 {
            font-size: 1.4em;
            margin-top: 25px;
        }
        p {
            margin-bottom: 20px;
        }
        .quote {
            border-left: 4px solid #2c3e50;
            padding-left: 15px;
            margin: 20px 0;
            font-style: italic;
        }
        .interactive-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin: 30px 0;
            background-color: #f9f9f9;
        }
        .canvas-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-group {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 200px;
        }
        .value-display {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        .flow-pattern {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
        }
        .flow-pattern-image {
            flex: 1;
            text-align: center;
            padding: 10px;
        }
        .flow-pattern-image img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
        }
        .flow-pattern-caption {
            margin-top: 10px;
            font-style: italic;
        }
        .highlight {
            background-color: #fffacd;
            padding: 2px 4px;
        }
        figure {
            margin: 25px 0;
            text-align: center;
        }
        figcaption {
            margin-top: 10px;
            font-style: italic;
            font-size: 0.9em;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        .conclusion {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 30px 0;
        }
    </style>
</head>
<body>
    <h1>The Dance of Bubbles: Understanding Flow Patterns in Electrical Submersible Pumps</h1>

    
    <p>Imagine you're drinking a milkshake through a straw, but instead of just pulling up the liquid, someone is also blowing air bubbles into the bottom of your drink. As you suck harder, you notice something interesting: sometimes you get mostly liquid, sometimes a mix of bubbles and liquid, and sometimes just air that makes that annoying slurping sound. What's happening is a fascinating physics problem that oil engineers deal with every day when using electrical submersible pumps (ESPs) to extract oil from deep wells.</p>
    
    <p>Today, I want to walk you through how engineers predict the behavior of these pumps when they have to handle both liquid and gas at the same time. It's a beautiful problem that combines fluid dynamics, rotational physics, and bubble mechanics. And the best part? We can build a model that actually predicts when the pump will start to struggle as gas bubbles increase.</p>
    
    <h2>The Problem with Pumping Gas and Liquid Together</h2>
    
    <p>Electrical submersible pumps are remarkable machines. They're essentially a stack of rotating impellers (think of them as fancy fan blades) that push fluid upward through a series of stages. Each stage adds pressure, helping to lift oil from deep underground to the surface.</p>
    
    <p>But here's the catch: oil wells don't just contain oil. They often have natural gas mixed in, and this creates a two-phase flow problem. When gas enters the pump, things get complicated fast. The pump, designed for incompressible liquids, suddenly has to deal with compressible gas bubbles that don't respond to pressure the same way.</p>
    
    <p>As researchers Zhu, Zhang, Zhu, and Zhang discovered, there are four distinct patterns that emerge when gas and liquid flow through these pumps:</p>
    
    <div class="flow-pattern">
        <div class="flow-pattern-image">
            <svg width="150" height="150" viewBox="0 0 100 100">
                <rect x="0" y="0" width="100" height="100" fill="#e6f7ff" stroke="#333" stroke-width="2"/>
                <circle cx="20" cy="20" r="3" fill="#003366"/>
                <circle cx="40" cy="30" r="2" fill="#003366"/>
                <circle cx="60" cy="25" r="2.5" fill="#003366"/>
                <circle cx="80" cy="40" r="2" fill="#003366"/>
                <circle cx="30" cy="50" r="3" fill="#003366"/>
                <circle cx="50" cy="60" r="2" fill="#003366"/>
                <circle cx="70" cy="70" r="2.5" fill="#003366"/>
                <circle cx="25" cy="80" r="2" fill="#003366"/>
                <circle cx="45" cy="75" r="3" fill="#003366"/>
                <circle cx="65" cy="85" r="2" fill="#003366"/>
                <circle cx="85" cy="15" r="2.5" fill="#003366"/>
                <circle cx="15" cy="65" r="2" fill="#003366"/>
            </svg>
            <div class="flow-pattern-caption">Dispersed Bubble Flow</div>
        </div>
        <div class="flow-pattern-image">
            <svg width="150" height="150" viewBox="0 0 100 100">
                <rect x="0" y="0" width="100" height="100" fill="#e6f7ff" stroke="#333" stroke-width="2"/>
                <circle cx="20" cy="20" r="6" fill="#003366" opacity="0.7"/>
                <circle cx="50" cy="30" r="8" fill="#003366" opacity="0.7"/>
                <circle cx="80" cy="25" r="7" fill="#003366" opacity="0.7"/>
                <circle cx="30" cy="60" r="9" fill="#003366" opacity="0.7"/>
                <circle cx="65" cy="70" r="7" fill="#003366" opacity="0.7"/>
                <circle cx="15" cy="85" r="8" fill="#003366" opacity="0.7"/>
            </svg>
            <div class="flow-pattern-caption">Bubbly Flow</div>
        </div>
        <div class="flow-pattern-image">
            <svg width="150" height="150" viewBox="0 0 100 100">
                <rect x="0" y="0" width="100" height="100" fill="#e6f7ff" stroke="#333" stroke-width="2"/>
                <ellipse cx="30" cy="30" rx="25" ry="15" fill="#003366" opacity="0.7"/>
                <ellipse cx="70" cy="70" rx="25" ry="15" fill="#003366" opacity="0.7"/>
            </svg>
            <div class="flow-pattern-caption">Intermittent Flow</div>
        </div>
        <div class="flow-pattern-image">
            <svg width="150" height="150" viewBox="0 0 100 100">
                <rect x="0" y="0" width="100" height="100" fill="#e6f7ff" stroke="#333" stroke-width="2"/>
                <path d="M0,0 L100,0 L100,100 L0,100 Z" fill="#003366" opacity="0.7"/>
                <path d="M10,10 C30,20 70,20 90,10 C70,30 30,30 10,10 Z" fill="#e6f7ff"/>
                <path d="M10,50 C30,60 70,60 90,50 C70,70 30,70 10,50 Z" fill="#e6f7ff"/>
            </svg>
            <div class="flow-pattern-caption">Segregated Flow</div>
        </div>
    </div>
    
    <p>These flow patterns aren't just academic curiosities—they directly affect how well the pump works. As the gas content increases, the pump's performance deteriorates, sometimes dramatically. Engineers call this sudden drop in performance "surging," and it's something they desperately want to predict and avoid.</p>
    
    <h2>The Physics of Bubbles in a Rotating Environment</h2>
    
    <p>To understand what's happening, we need to think about the forces acting on gas bubbles inside a rapidly spinning pump. Unlike in a stationary pipe, where gravity is the dominant force affecting bubbles, in a rotating pump, the centrifugal force becomes much more important.</p>
    
    <p>When a pump spins, it creates a centrifugal acceleration that can be many times greater than gravity. This acceleration is given by:</p>
    
    <p>\[ a_c = \Omega^2 R_I \]</p>
    
    <p>where \(\Omega\) is the angular velocity (how fast the pump is spinning) and \(R_I\) is the radius of the impeller. For a typical ESP running at 3500 rpm, this acceleration can be over 100 times gravity!</p>
    
    <p>This strong centrifugal field affects gas bubbles differently than the liquid. Since gas is much lighter than liquid, bubbles experience a buoyant force that pushes them toward the center of rotation (opposite to the centrifugal force on the liquid). This sets up a complex flow pattern where bubbles and liquid interact in ways that depend on how much gas is present, how fast the pump is spinning, and how much liquid is flowing through.</p>
    
    <h2>The Transition Boundaries: When Patterns Change</h2>
    
    <p>The researchers developed a mechanistic model to predict when the flow will transition from one pattern to another. Let's break down these transitions one by one.</p>
    
    <h3>From Dispersed Bubble to Bubbly Flow</h3>
    
    <p>When gas first enters the pump, it forms tiny, well-distributed bubbles throughout the liquid. This is called dispersed bubble flow. As the gas content increases, something interesting happens: the bubbles start to grow and coalesce. This transition occurs when the maximum bubble size exceeds a critical diameter:</p>
    
    <p>\[ d_{\text{max}} \leq d_{CD} \]</p>
    
    <p>The critical bubble diameter in a centrifugal pump is given by:</p>
    
    <p>\[ d_{CRIT} = 2 \sqrt{\frac{0.4\sigma}{(\rho_L-\rho_G)\Omega^2 R_I}} \]</p>
    
    <p>where \(\sigma\) is the surface tension, \(\rho_L\) and \(\rho_G\) are the liquid and gas densities, and \(\Omega\) and \(R_I\) are as defined earlier.</p>
    
    <p>The maximum bubble size in the turbulent environment of the pump is predicted by:</p>
    
    <p>\[ d_{\text{max}} = 10.056 \lambda_G \left(\frac{\sigma}{\rho_c}\right)^{\frac{3}{5}} \left(\frac{\Delta P Q_L}{\rho_c V}\right)^{-\frac{2}{5}} \left(\frac{\rho_c}{\rho_d}\right)^{\frac{1}{5}} \]</p>
    
    <p>where \(\lambda_G\) is the inlet gas volumetric fraction (GVF), \(\Delta P\) is the pressure increment of a single stage, \(Q_L\) is the liquid flow rate, and \(V\) is the impeller volume.</p>
    
    <p>By equating these two expressions, we can find the critical gas fraction that triggers the transition:</p>
    
    <p>\[ \lambda_C = \frac{2\left[\cfrac{0.4\sigma}{\big(\rho_{L}-\rho_{G}\big)\Omega^{2}R_{I}}\right]^{\frac{1}{2}}}{10.056\left(\cfrac{\sigma}{\rho_{L}}\right)^{\frac{3}{5}}\left(\cfrac{\Delta P Q_{L}}{\rho_{L}V}\right)^{-\frac{2}{5}}\left(\cfrac{\rho_{L}}{\rho_{G}}\right)^{\frac{1}{5}}} \]</p>
    
    <h3>From Bubbly Flow to Intermittent Flow</h3>
    
    <p>As even more gas enters the system, the bubbles become so numerous that they start to pack together and merge into larger gas pockets. This transition happens when the gas void fraction (the proportion of space occupied by gas) reaches a critical value:</p>
    
    <p>\[ \alpha_{Crit} = \frac{\pi}{6} - \left(\frac{\pi}{6} - \frac{1}{4}\right) \exp\left(-\left(\frac{N}{N_{REF}}\right)^n\right) \]</p>
    
    <p>where \(N\) is the rotational speed and \(N_{REF}\) is the reference speed (typically 3500 rpm for most ESPs). The actual gas void fraction in the pump can be calculated as:</p>
    
    <p>\[ \alpha_G = \frac{R_s - 1 + \sqrt{(1-R_s)^2 + 4R_s\lambda_G}}{2R_s} \]</p>
    
    <p>where \(R_s\) is a complex parameter that accounts for the balance of forces on the bubbles.</p>
    
    <h3>From Intermittent Flow to Segregated Flow</h3>
    
    <p>Finally, when the gas content becomes very high, the flow separates completely into gas and liquid regions. This transition is modeled using a momentum balance equation:</p>
    
    <p>\[ -\frac{\tau_{F}S_{F}}{H_{LF}A} - \tau_{I}S_{I}\left(\frac{1}{H_{LF}A} + \frac{1}{(1-H_{LF})A}\right) + (\rho_L-\rho_C)\Omega^2 R_I\big|_{streamline} = 0 \]</p>
    
    <p>This equation balances the wall friction, interfacial friction, and centrifugal forces acting on the fluid.</p>
    
    <div class="interactive-container">
        <h3>Interactive Flow Pattern Simulator</h3>
        <p>Move the sliders to see how different parameters affect the flow patterns in an electrical submersible pump.</p>
        
        <div class="controls">
            <div class="control-group">
                <label for="gvf-slider">Gas Volumetric Fraction (GVF)</label>
                <input type="range" id="gvf-slider" min="0" max="0.5" step="0.01" value="0.1">
                <div class="value-display" id="gvf-value">0.1</div>
            </div>
            
            <div class="control-group">
                <label for="rpm-slider">Pump Speed (RPM)</label>
                <input type="range" id="rpm-slider" min="1000" max="4000" step="100" value="3500">
                <div class="value-display" id="rpm-value">3500 RPM</div>
            </div>
            
            <div class="control-group">
                <label for="flow-slider">Liquid Flow Rate (% of BEP)</label>
                <input type="range" id="flow-slider" min="20" max="150" step="5" value="100">
                <div class="value-display" id="flow-value">100% of BEP</div>
            </div>
            
            <div class="control-group">
                <label for="pressure-slider">Intake Pressure (PSIG)</label>
                <input type="range" id="pressure-slider" min="50" max="200" step="10" value="100">
                <div class="value-display" id="pressure-value">100 PSIG</div>
            </div>
        </div>
        
        <div>
            <p><strong>Current Flow Pattern: <span id="flow-pattern-display">Bubbly Flow</span></strong></p>
            <p><strong>Pump Performance: <span id="performance-display">90% of Single-Phase</span></strong></p>
        </div>
        
        <div class="canvas-container">
            <canvas id="flowPatternCanvas"></canvas>
        </div>
        
        <div class="canvas-container">
            <canvas id="performanceCanvas"></canvas>
        </div>
    </div>
    
    <h2>The Experimental Validation</h2>
    
    <p>The beauty of physics is that we can test our theoretical models against reality. The researchers built a test facility with a 14-stage ESP and carefully measured the pressure at each stage while varying the gas and liquid flow rates.</p>
    
    <p>They conducted two types of tests:</p>
    
    <ol>
        <li><strong>Surging tests</strong>: Fixed liquid flow rate, increasing gas flow rate</li>
        <li><strong>Mapping tests</strong>: Fixed gas flow rate, varying liquid flow rate</li>
    </ol>
    
    <p>By analyzing the performance curves from these tests, they could identify the flow pattern transitions and compare them with their model predictions. The results showed good agreement, validating their mechanistic approach.</p>
    
    <h2>Why This Matters: The Real-World Impact</h2>
    
    <p>You might be wondering why we should care about bubbles in pumps. The answer is both practical and economic. ESPs are widely used in the petroleum industry, especially for offshore wells where high production rates are needed. When these pumps fail due to gas-handling issues, it can cost millions of dollars in lost production and equipment replacement.</p>
    
    <p>By understanding the flow patterns and predicting when transitions will occur, engineers can:</p>
    
    <ul>
        <li>Design better pumps that handle gas more effectively</li>
        <li>Operate existing pumps within their stable regions</li>
        <li>Implement control strategies to avoid damaging surging conditions</li>
        <li>Increase the run life of ESPs, reducing maintenance costs</li>
    </ul>
    
    <h2>The Bigger Picture: A Unified Approach to Two-Phase Flow</h2>
    
    <p>What's particularly elegant about this research is how it connects to broader principles of two-phase flow. The researchers adapted concepts from pipe flow—like slug dynamics and bubble mechanics—to the rotating environment of a pump.</p>
    
    <p>The key insight was recognizing that the centrifugal field in a pump plays a similar role to gravity in vertical pipe flow, but with much greater magnitude and different geometry. This allowed them to modify existing models rather than starting from scratch.</p>
    
    <div class="conclusion">
        <h3>Conclusion: The Dance of Forces</h3>
        <p>At its heart, this problem is about a delicate balance of forces: drag, buoyancy, surface tension, and inertia, all playing out in a rapidly rotating environment. The transitions between flow patterns represent tipping points where one set of forces begins to dominate over another.</p>
        
        <p>By breaking down this complex system into its fundamental components and applying first principles of physics, the researchers were able to create a predictive model that matches experimental observations. It's a beautiful example of how understanding the basic forces at play can help us make sense of complex, real-world phenomena.</p>
        
        
    </div>
    
    <script>
        // Initialize sliders and displays
        const gvfSlider = document.getElementById('gvf-slider');
        const rpmSlider = document.getElementById('rpm-slider');
        const flowSlider = document.getElementById('flow-slider');
        const pressureSlider = document.getElementById('pressure-slider');
        
        const gvfValue = document.getElementById('gvf-value');
        const rpmValue = document.getElementById('rpm-value');
        const flowValue = document.getElementById('flow-value');
        const pressureValue = document.getElementById('pressure-value');
        
        const flowPatternDisplay = document.getElementById('flow-pattern-display');
        const performanceDisplay = document.getElementById('performance-display');
        
        // Flow pattern chart
        const flowPatternCanvas = document.getElementById('flowPatternCanvas');
        const flowPatternCtx = flowPatternCanvas.getContext('2d');
        let flowPatternChart;
        
        // Performance chart
        const performanceCanvas = document.getElementById('performanceCanvas');
        const performanceCtx = performanceCanvas.getContext('2d');
        let performanceChart;
        
        // Initialize charts
        function initCharts() {
            // Flow pattern visualization
            flowPatternChart = new Chart(flowPatternCtx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Gas Bubbles',
                        data: generateBubbleData(0.1, 3500),
                        backgroundColor: 'rgba(0, 51, 102, 0.7)',
                        borderColor: 'rgba(0, 51, 102, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Position in Impeller'
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Radial Position'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Gas Bubble Distribution in ESP Impeller'
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Performance curve visualization
            performanceChart = new Chart(performanceCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 11}, (_, i) => i * 10),
                    datasets: [{
                        label: 'Single-Phase Performance',
                        data: generateSinglePhasePerformance(),
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 2,
                        fill: false
                    }, {
                        label: 'Two-Phase Performance',
                        data: generateTwoPhasePerformance(0.1, 3500, 100, 100),
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Flow Rate (% of BEP)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Head (psi)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'ESP Performance Curve'
                        }
                    }
                }
            });
        }
        
        // Generate bubble data based on GVF and RPM
        function generateBubbleData(gvf, rpm) {
            const bubbles = [];
            const numBubbles = Math.floor(gvf * 100) + 5;
            
            // Determine flow pattern
            const flowPattern = determineFlowPattern(gvf, rpm, flowSlider.value, pressureSlider.value);
            
            switch(flowPattern) {
                case 'Dispersed Bubble Flow':
                    // Many small bubbles distributed throughout
                    for (let i = 0; i < numBubbles; i++) {
                        bubbles.push({
                            x: Math.random() * 100,
                            y: Math.random() * 100,
                            r: Math.random() * 3 + 1
                        });
                    }
                    break;
                    
                case 'Bubbly Flow':
                    // Fewer, larger bubbles
                    for (let i = 0; i < numBubbles / 2; i++) {
                        bubbles.push({
                            x: Math.random() * 100,
                            y: Math.random() * 100,
                            r: Math.random() * 6 + 4
                        });
                    }
                    break;
                    
                case 'Intermittent Flow':
                    // Large gas pockets interspersed with liquid
                    for (let i = 0; i < 5; i++) {
                        bubbles.push({
                            x: 20 + i * 15,
                            y: 30 + Math.random() * 40,
                            r: Math.random() * 10 + 10
                        });
                    }
                    break;
                    
                case 'Segregated Flow':
                    // Gas and liquid completely separated
                    for (let i = 0; i < 3; i++) {
                        bubbles.push({
                            x: 30 + i * 20,
                            y: 80,
                            r: 15
                        });
                    }
                    // Add a few small bubbles in the liquid region
                    for (let i = 0; i < 5; i++) {
                        bubbles.push({
                            x: Math.random() * 100,
                            y: Math.random() * 30,
                            r: Math.random() * 3 + 1
                        });
                    }
                    break;
            }
            
            return bubbles;
        }
        
        // Generate single-phase performance curve
        function generateSinglePhasePerformance() {
            // Typical ESP performance curve shape
            return [5, 15, 22, 27, 30, 31, 30, 27, 22, 15, 5];
        }
        
        // Generate two-phase performance curve based on parameters
        function generateTwoPhasePerformance(gvf, rpm, flowPct, pressure) {
            const singlePhase = generateSinglePhasePerformance();
            const flowPattern = determineFlowPattern(gvf, rpm, flowPct, pressure);
            
            let performanceFactor;
            switch(flowPattern) {
                case 'Dispersed Bubble Flow':
                    performanceFactor = 0.9 - gvf * 0.5;
                    break;
                case 'Bubbly Flow':
                    performanceFactor = 0.7 - gvf * 1.0;
                    break;
                case 'Intermittent Flow':
                    performanceFactor = 0.4 - gvf * 1.5;
                    break;
                case 'Segregated Flow':
                    performanceFactor = 0.1;
                    break;
                default:
                    performanceFactor = 1.0;
            }
            
            // Adjust for intake pressure (higher pressure improves performance)
            performanceFactor *= (0.8 + 0.004 * pressure);
            
            // Adjust for RPM (higher RPM can handle more gas)
            performanceFactor *= (0.7 + 0.0001 * rpm);
            
            // Cap the factor
            performanceFactor = Math.min(performanceFactor, 1.0);
            performanceFactor = Math.max(performanceFactor, 0.05);
            
            // Update performance display
            performanceDisplay.textContent = `${Math.round(performanceFactor * 100)}% of Single-Phase`;
            
            // Apply the factor to the single-phase curve
            return singlePhase.map(value => value * performanceFactor);
        }
        
        // Determine flow pattern based on input parameters
        function determineFlowPattern(gvf, rpm, flowPct, pressure) {
            // Simplified model based on the paper's transitions
            
            // Normalize parameters
            const normalizedGvf = gvf;
            const normalizedRpm = rpm / 3500;
            const normalizedFlow = flowPct / 100;
            const normalizedPressure = pressure / 100;
            
            // Critical GVF for dispersed bubble to bubbly transition
            // Higher rpm and pressure increase this threshold
            const dispersedToBubblyThreshold = 0.05 * normalizedRpm * Math.sqrt(normalizedPressure);
            
            // Critical GVF for bubbly to intermittent transition
            // Depends more on flow rate
            const bubblyToIntermittentThreshold = 0.15 * normalizedRpm * normalizedFlow;
            
            // Critical GVF for intermittent to segregated transition
            const intermittentToSegregatedThreshold = 0.3 * normalizedRpm * normalizedFlow;
            
            // Determine flow pattern
            if (normalizedGvf < dispersedToBubblyThreshold) {
                return 'Dispersed Bubble Flow';
            } else if (normalizedGvf < bubblyToIntermittentThreshold) {
                return 'Bubbly Flow';
            } else if (normalizedGvf < intermittentToSegregatedThreshold) {
                return 'Intermittent Flow';
            } else {
                return 'Segregated Flow';
            }
        }
        
        // Update slider value displays
        function updateDisplays() {
            gvfValue.textContent = gvfSlider.value;
            rpmValue.textContent = `${rpmSlider.value} RPM`;
            flowValue.textContent = `${flowSlider.value}% of BEP`;
            pressureValue.textContent = `${pressureSlider.value} PSIG`;
            
            // Update flow pattern display
            const flowPattern = determineFlowPattern(
                parseFloat(gvfSlider.value),
                parseInt(rpmSlider.value),
                parseInt(flowSlider.value),
                parseInt(pressureSlider.value)
            );
            flowPatternDisplay.textContent = flowPattern;
            
            // Update charts
            updateCharts();
        }
        
        // Update charts based on current slider values
        function updateCharts() {
            const gvf = parseFloat(gvfSlider.value);
            const rpm = parseInt(rpmSlider.value);
            const flowPct = parseInt(flowSlider.value);
            const pressure = parseInt(pressureSlider.value);
            
            // Update bubble chart
            flowPatternChart.data.datasets[0].data = generateBubbleData(gvf, rpm);
            flowPatternChart.update();
            
            // Update performance chart
            performanceChart.data.datasets[1].data = generateTwoPhasePerformance(gvf, rpm, flowPct, pressure);
            performanceChart.update();
        }
        
        // Event listeners for sliders
        gvfSlider.addEventListener('input', updateDisplays);
        rpmSlider.addEventListener('input', updateDisplays);
        flowSlider.addEventListener('input', updateDisplays);
        pressureSlider.addEventListener('input', updateDisplays);
        
        // Initialize on page load
        window.onload = function() {
            initCharts();
            updateDisplays();
        };
    </script>
</body>
