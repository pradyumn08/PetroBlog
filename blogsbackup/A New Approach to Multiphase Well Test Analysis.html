<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding Multiphase Well Testing: The p² Approach</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 30px;
        }
        h1 {
            font-size: 2.2em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            font-size: 1.8em;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 5px;
        }
        h3 {
            font-size: 1.4em;
        }
        p {
            margin-bottom: 20px;
        }
        .formula-box {
            background-color: #f5f5f5;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            overflow-x: auto;
        }
        .key-concept {
            background-color: #e8f4f8;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .interactive-section {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .slider-container {
            margin: 20px 0;
        }
        .slider {
            width: 100%;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        .note {
            background-color: #fffacd;
            padding: 10px;
            border-left: 3px solid #f1c40f;
            margin: 15px 0;
        }
        .example {
            background-color: #e8f8f5;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .tabs {
            display: flex;
            margin-bottom: 10px;
        }
        .tab {
            padding: 10px 15px;
            background-color: #e0e0e0;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background-color: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 15px;
            background-color: #fff;
            border-radius: 0 5px 5px 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .tab-content.active {
            display: block;
        }
        .conclusion {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 30px;
        }
        figure {
            text-align: center;
            margin: 20px 0;
        }
        figcaption {
            font-style: italic;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Simplifying Multiphase Well Testing: The p² Approach</h1>
    
    <div class="key-concept">
        <h3>Key Takeaway</h3>
        <p>This blog post breaks down a revolutionary approach to multiphase well testing that uses p² (pressure squared) as the dependent variable. This method simplifies complex non-linear equations into a form that's easier to solve while providing more accurate results than traditional approaches.</p>
    </div>

    <h2>The Challenge of Multiphase Flow</h2>
    
    <p>Petroleum engineers face a significant challenge when analyzing wells that produce multiple phases (oil, gas, and water) simultaneously. The equations that describe this flow are highly non-linear and don't yield simple analytical solutions.</p>
    
    <p>Until now, two main approaches have been used:</p>
    <ol>
        <li><strong>Perrine's approach</strong>: A modified single-phase solution that replaces single-phase properties with total system properties</li>
        <li><strong>Raghavan's pseudopressure approach</strong>: An integral transformation method for solution gas-drive reservoirs</li>
    </ol>
    
    <p>Both approaches have limitations. Perrine's approach tends to underestimate effective phase permeabilities and overestimate skin, while Raghavan's approach requires tedious pressure transformations and is sensitive to inaccuracies in relative permeability data.</p>

    <h2>First Principles: The Multiphase Flow Equations</h2>
    
    <p>To understand our new approach, let's start with the fundamental equations that govern multiphase flow in reservoirs. For a system with oil, gas, and water (neglecting gravity and capillary effects), we have:</p>
    
    <div class="formula-box">
        <p><strong>For oil:</strong></p>
        \begin{equation}
        \nabla.\left[{\frac{k k_{r o}}{\mu_{o}B_{o}}}\nabla p\right]={\frac{\partial}{\partial t}}\left[{\frac{\phi S_{o}}{B_{o}}}\right]
        \end{equation}
        
        <p><strong>For gas:</strong></p>
        \begin{equation}
        \nabla \cdot\left[\left[\frac{k k_{r g}}{\mu_{g}B_{g}}+\frac{R_{s}k k_{r o}}{\mu_{o}B_{o}}\right]\nabla p\right]=\frac{\partial}{\partial t}\left[\frac{\phi S_{g}}{B_{g}}+\frac{\phi R_{s}S_{o}}{B_{o}}\right]
        \end{equation}
        
        <p><strong>For water:</strong></p>
        \begin{equation}
        \nabla\cdot\left[\frac{k\:k_{rw}}{\mu_{w}\:B_{w}}\:\nabla p\right]=\frac{\partial}{\partial t}\:\left[\frac{\phi\:S_{w}}{B_{w}}\right]
        \end{equation}
    </div>
    
    <p>Where:</p>
    <ul>
        <li>\(k\) = absolute permeability</li>
        <li>\(k_{r}\) = relative permeability for each phase</li>
        <li>\(\mu\) = viscosity</li>
        <li>\(B\) = formation volume factor</li>
        <li>\(p\) = pressure</li>
        <li>\(\phi\) = porosity</li>
        <li>\(S\) = saturation</li>
        <li>\(R_s\) = solution gas-oil ratio</li>
    </ul>

    <h2>The Key Insight: Transforming to p²</h2>
    
    <p>The breakthrough comes from a simple but powerful observation: when we manipulate these equations in a specific way, we can derive a diffusivity equation in terms of p² (pressure squared) that is much easier to solve.</p>
    
    <div class="formula-box">
        <p>Through mathematical manipulation (multiplying the oil equation by \([B_o - B_g R_s]\), the gas equation by \(B_g\), and the water equation by \(B_w\)), we can combine these equations to get:</p>
        
        \begin{equation}
        \nabla^2 p^2 = \frac{\phi c_t}{\lambda_t}\frac{\partial p^2}{\partial t}
        \end{equation}
    </div>
    
    <p>This is a standard form of the diffusivity equation, but now with p² as the dependent variable instead of p. This transformation makes the equation linear and solvable with standard techniques, provided we make some reasonable assumptions.</p>

    <div class="key-concept">
        <h3>The Critical Assumption</h3>
        <p>The key assumption that enables this transformation is that \(\frac{k_o}{\mu_o B_o}\) varies linearly with pressure:</p>
        
        \begin{equation}
        \frac{k_o}{\mu_o B_o} = ap
        \end{equation}
        
        <p>Where \(a\) is a constant that can be determined empirically. This assumption is supported by numerical simulations and physical understanding of the system.</p>
    </div>

    <h2>Interactive Demonstration: Visualizing the Linear Relationship</h2>
    
    <div class="interactive-section">
        <h3>Explore how \(\frac{k_o}{\mu_o B_o}\) varies with pressure</h3>
        
        <p>The foundation of our p² approach relies on the approximately linear relationship between \(\frac{k_o}{\mu_o B_o}\) and pressure. Use the sliders below to see how this relationship holds for different oil volatilities and pressure ranges.</p>
        
        <div class="slider-container">
            <label for="volatility">Oil Volatility (0 = Low, 1 = High): </label>
            <input type="range" id="volatility" class="slider" min="0" max="1" step="0.1" value="0.5">
            <span id="volatility-value">0.5</span>
        </div>
        
        <div class="slider-container">
            <label for="pressure-range">Pressure Range (psi): </label>
            <input type="range" id="pressure-range" class="slider" min="1000" max="5000" step="500" value="3000">
            <span id="pressure-range-value">3000</span>
        </div>
        
        <div class="chart-container">
            <canvas id="linearityChart"></canvas>
        </div>
        
        <p class="note">Note: As you can see, the relationship is approximately linear for most practical pressure ranges, validating our key assumption.</p>
    </div>

    <h2>The Line Source Solution</h2>
    
    <p>Once we have our diffusivity equation in terms of p², we can solve it using standard techniques. For a well in an infinite, homogeneous reservoir producing at a constant rate, the line source solution is:</p>
    
    <div class="formula-box">
        \begin{equation}
        p_i^2 - p^2(r,t) = \frac{q_o}{2\pi a h}\left[-E_i\left[-\frac{\phi r^2}{4t}\frac{c_t}{\lambda_t}\right]\right]
        \end{equation}
        
        <p>Using the logarithmic approximation (for field units):</p>
        
        \begin{equation}
        p_{wf}^2 - p_i^2 = -\frac{325.2q_o}{a h}\left[\log{t} + \log{\left(\frac{\lambda_t}{\phi c_t r_w^2}\right)} - 3.228 + 0.869s\right]
        \end{equation}
    </div>
    
    <p>Where:</p>
    <ul>
        <li>\(p_i\) = initial pressure</li>
        <li>\(p_{wf}\) = flowing wellbore pressure</li>
        <li>\(q_o\) = oil flow rate</li>
        <li>\(h\) = reservoir thickness</li>
        <li>\(a\) = empirical slope from our linear relationship</li>
        <li>\(\lambda_t\) = total mobility</li>
        <li>\(c_t\) = total system compressibility</li>
        <li>\(s\) = skin factor</li>
    </ul>

    <h2>Determining the Empirical Slope</h2>
    
    <p>The empirical slope \(a\) is crucial for accurate results. Based on extensive testing, we've found three different ways to evaluate this slope depending on the oil volatility and test conditions:</p>
    
    <div class="tabs">
        <div class="tab active" data-tab="approach1">Approach 1: Average Pressure</div>
        <div class="tab" data-tab="approach2">Approach 2: Initial Pressure</div>
        <div class="tab" data-tab="approach3">Approach 3: Early-Time Pressure</div>
    </div>
    
    <div id="approach1" class="tab-content active">
        <h3>Approach 1: Average Pressure Over a Semilog Cycle</h3>
        <p>Evaluate \(a\) at the average pressure over a semilog cycle of the p² vs log t plot:</p>
        
        \begin{equation}
        a = \left(\frac{k_o}{\mu_o B_o}\right)_{\frac{p_{1hr} + p_{10hr}}{2}} \cdot \frac{2}{(p_{1hr} + p_{10hr})}
        \end{equation}
        
        <p>This approach leads to:</p>
        
        \begin{equation}
        k_o = \frac{162.6 q_o (\mu_o B_o)_{\frac{p_{1hr} + p_{10hr}}{2}}}{m^* h}
        \end{equation}
        
        <p>This is nearly identical to Perrine's approach, which explains why it tends to underestimate effective oil permeabilities.</p>
    </div>
    
    <div id="approach2" class="tab-content">
        <h3>Approach 2: Initial/Average Reservoir Pressure</h3>
        <p>Evaluate \(a\) at the initial pressure for drawdowns or average reservoir pressure for buildups:</p>
        
        \begin{equation}
        a = \left(\frac{k_o}{\mu_o B_o}\right)_i \cdot \frac{1}{p_i}
        \end{equation}
        
        <p>This leads to:</p>
        
        \begin{equation}
        k_o = \frac{325.2 q_o p_i (\mu_o B_o)_i}{m h}
        \end{equation}
        
        <p>For buildups:</p>
        
        \begin{equation}
        k_o = \frac{325.2 q_o \bar{p} (\mu_o \bar{B}_o)}{m h}
        \end{equation}
        
        <p>This approach works well for highly volatile oils and for low drawdowns in oils with low volatility.</p>
    </div>
    
    <div id="approach3" class="tab-content">
        <h3>Approach 3: Early/Late Test Pressures</h3>
        <p>For high drawdowns in oils with low volatility, evaluate \(a\) at \(p_{wf}\) (t = 0.1 hr) for drawdowns or at \(p_{ws}\) (Δt = 10 hr) for buildups:</p>
        
        \begin{equation}
        k_o = \frac{325.2 q_o p_{0.1hr} (\mu_o B_o)_{p_{0.1hr}}}{m h}
        \end{equation}
        
        <p>For buildups:</p>
        
        \begin{equation}
        k_o = \frac{325.2 q_o p_{10hr} (\mu_o B_o)_{p_{10hr}}}{m h}
        \end{equation}
        
        <p>This approach avoids both the underestimation of Approach 1 and potential overestimation of Approach 2 for these specific conditions.</p>
    </div>

    <h2>Interactive Well Test Analyzer</h2>
    
    <div class="interactive-section">
        <h3>Analyze a Multiphase Well Test</h3>
        
        <p>This simulator lets you input well test data and see how the p² approach compares to Perrine's approach in calculating effective permeabilities and skin.</p>
        
        <div class="slider-container">
            <label for="oil-rate">Oil Rate (STB/D): </label>
            <input type="range" id="oil-rate" class="slider" min="100" max="1000" step="50" value="500">
            <span id="oil-rate-value">500</span>
        </div>
        
        <div class="slider-container">
            <label for="initial-pressure">Initial Pressure (psi): </label>
            <input type="range" id="initial-pressure" class="slider" min="2000" max="5000" step="100" value="3500">
            <span id="initial-pressure-value">3500</span>
        </div>
        
        <div class="slider-container">
            <label for="gas-oil-ratio">Gas-Oil Ratio (SCF/STB): </label>
            <input type="range" id="gas-oil-ratio" class="slider" min="500" max="2000" step="100" value="1000">
            <span id="gas-oil-ratio-value">1000</span>
        </div>
        
        <div class="slider-container">
            <label for="water-oil-ratio">Water-Oil Ratio: </label>
            <input type="range" id="water-oil-ratio" class="slider" min="0" max="1" step="0.1" value="0.5">
            <span id="water-oil-ratio-value">0.5</span>
        </div>
        
        <div class="slider-container">
            <label for="test-type">Test Type (0 = Drawdown, 1 = Buildup): </label>
            <input type="range" id="test-type" class="slider" min="0" max="1" step="1" value="0">
            <span id="test-type-value">Drawdown</span>
        </div>
        
        <div class="chart-container">
            <canvas id="testAnalysisChart"></canvas>
        </div>
        
        <table id="results-table">
            <tr>
                <th>Parameter</th>
                <th>Perrine's Approach</th>
                <th>p² Approach</th>
                <th>Actual Value</th>
            </tr>
            <tr>
                <td>Effective Oil Permeability (md)</td>
                <td id="perrine-ko">-</td>
                <td id="p2-ko">-</td>
                <td id="actual-ko">-</td>
            </tr>
            <tr>
                <td>Effective Gas Permeability (md)</td>
                <td id="perrine-kg">-</td>
                <td id="p2-kg">-</td>
                <td id="actual-kg">-</td>
            </tr>
            <tr>
                <td>Skin Factor</td>
                <td id="perrine-skin">-</td>
                <td id="p2-skin">-</td>
                <td id="actual-skin">-</td>
            </tr>
        </table>
    </div>

    <h2>Real-World Applications</h2>
    
    <p>The p² approach has been validated using both simulated tests and real field data. Let's look at some examples:</p>
    
    <div class="example">
        <h3>Example 1: Highly Volatile Oil System</h3>
        
        <p>For a highly volatile oil system, we applied the p² approach to analyze both drawdown and buildup tests. The results showed that the p² approach estimated effective oil permeability with an error of less than 5%, compared to Perrine's approach which underestimated by about 15%.</p>
        
        <figure>
            <img src="https://via.placeholder.com/600x400" alt="Plot showing drawdown test analysis">
            <figcaption>Fig. 1: Drawdown test analysis for a highly volatile oil system</figcaption>
        </figure>
    </div>
    
    <div class="example">
        <h3>Example 2: Low Volatility Oil with High Drawdown</h3>
        
        <p>For a system with low oil volatility and high drawdown, the p² approach with the appropriate empirical slope (Approach 3) gave results within 7% of the actual values, while Perrine's approach underestimated effective oil permeability by over 25%.</p>
        
        <figure>
            <img src="https://via.placeholder.com/600x400" alt="Plot showing high drawdown test analysis">
            <figcaption>Fig. 2: High drawdown test analysis for a low volatility oil system</figcaption>
        </figure>
    </div>

    <h2>Theoretical Implications</h2>
    
    <p>Beyond just providing a practical tool for well test analysis, the p² approach has helped derive and explain several existing multiphase relations:</p>
    
    <h3>1. Fetkovich's Isochronal Testing Approach</h3>
    
    <p>Fetkovich's empirical approach for isochronal oil well testing has been in use since 1973 without theoretical derivation. Using the p² approach, we can now derive this relation from first principles:</p>
    
    <div class="formula-box">
        \begin{equation}
        q_o = J_o' \{\bar{p}^2 - p_{wf}^2\}^n
        \end{equation}
        
        <p>Where:</p>
        
        \begin{equation}
        J_o' = \frac{2\pi k h}{\ln\left[\frac{0.472r_e}{r_w}\right]}\left[\frac{\bar{k}_{ro}}{2\mu_o\bar{B}_o\bar{p}}\right]
        \end{equation}
    </div>
    
    <h3>2. Pressure-Saturation Relations</h3>
    
    <p>The p² approach also provides a new derivation of the pressure-saturation relation reported by both Muskat and Martin:</p>
    
    <div class="formula-box">
        \begin{equation}
        \frac{dS_o}{dp} = \frac{\lambda_o}{\lambda_t}c_t - S_o(c_o + c_f)
        \end{equation}
    </div>

    <h2>Estimating Absolute Permeability</h2>
    
    <p>A unique application of the p² approach is the ability to estimate absolute permeability in multiphase reservoirs. By applying a relative permeability technique to multiple-rate tests, we can fit the effective permeabilities to a polynomial:</p>
    
    <div class="formula-box">
        \begin{equation}
        k_w = k(S_w)^{n'}
        \end{equation}
    </div>
    
    <p>This regression yields both the absolute permeability \(k\) and an exponent \(n'\).</p>
    
    <div class="example">
        <h3>Example Application</h3>
        
        <p>In one test case with an input absolute permeability of 10.0 md, the p² approach estimated 9.54 md—an error of less than 5%.</p>
    </div>

    <h2>Interactive Game: "Well Test Analyst"</h2>
    
    <div class="interactive-section" id="game-container">
        <h2>Test Your Knowledge</h2>
        <div id="game-scenario">
            <h4>Question: Which approach is most accurate for buildup tests or tests with high drawdown?</h4>
        </div>
        <div id="game-options">
            <button id="option1">Perrine's Approach</button>
            <button id="option2">p² Approach with Approach 1 (Average Pressure)</button>
            <button id="option3">p² Approach with Approach 2 (Initial Pressure)</button>
            <button id="option4">p² Approach with Approach 3 (Early Test Pressure)</button>
        </div>
        <div id="game-feedback" style="display: none;"></div>
        <p>Score: <span id="score">0/1</span></p>
    </div>

    <div class="conclusion">
        <h2>Conclusions</h2>
        
        <ol>
            <li>The p² approach simplifies multiphase flow equations to a solvable diffusivity equation in terms of pressure squared.</li>
            <li>This approach provides more accurate estimates of effective phase permeabilities than Perrine's traditional method.</li>
            <li>Different empirical slopes can be used depending on oil volatility and test conditions, making the method adaptable to various reservoir scenarios.</li>
            <li>The approach also provides theoretical foundations for several empirical relations used in petroleum engineering, including Fetkovich's isochronal testing approach.</li>
            <li>A unique application allows for estimation of absolute permeability in multiphase reservoirs.</li>
        </ol>
        
        <p>The p² approach represents a significant advancement in multiphase well testing, offering a practical tool that balances theoretical rigor with ease of application.</p>
    </div>

    <script>
        // --- FUNCTION DEFINITIONS ---

        function openTab(evt, tabName) {
            const tabcontent = document.querySelectorAll('#blog-viewer .tab-content');
            tabcontent.forEach(content => content.classList.remove('active'));
            const tablinks = document.querySelectorAll('#blog-viewer .tab');
            tablinks.forEach(tab => tab.classList.remove('active'));
            const contentToShow = document.getElementById(tabName);
            if (contentToShow) contentToShow.classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        function checkAnswer(answer) {
            const feedback = document.getElementById('game-feedback');
            const scoreEl = document.getElementById('score');
            if (answer === 4) { // Correct answer is Approach 3
                feedback.textContent = 'Correct! Approach 3 is best for high drawdown scenarios.';
                feedback.style.color = 'green';
                scoreEl.textContent = '1/1';
            } else {
                feedback.textContent = 'Not quite. According to the article, Approach 3 is most accurate for buildup tests or tests with high drawdown.';
                feedback.style.color = 'red';
                scoreEl.textContent = '0/1';
            }
            feedback.style.display = 'block';
        }

        function generateLinearityData(volatility, pressureRange) {
            const data = [];
            const startPressure = 500;
            const pressureStep = 100;
            for (let p = startPressure; p <= pressureRange; p += pressureStep) {
                let value = 0.02 * p * (1 + 0.1 * volatility) - (1 - volatility) * 0.00001 * p * p;
                value += (Math.random() - 0.5) * 0.5; // Add noise
                data.push({x: p, y: value});
            }
            return data;
        }

        function updateLinearityChart(chart, volatility, pressureRange) {
            chart.data.datasets[0].data = generateLinearityData(volatility, pressureRange);
            chart.update();
        }

        function generateTestData(oilRate, initialPressure, gor, wor, testType) {
            const data = [];
            const times = [0.1, 0.2, 0.5, 1, 2, 5, 10, 20, 50, 100];
            if (testType === 0) { // Drawdown
                times.forEach(time => {
                    const pressureSquared = initialPressure * initialPressure - (oilRate * (1 + 0.1 * gor/1000) * (1 + 0.2 * wor)) * Math.log10(time + 0.1) * 5000;
                    data.push(Math.max(pressureSquared, 0));
                });
            } else { // Buildup
                times.forEach(time => {
                    const pressureSquared = initialPressure * initialPressure * 0.7 + (initialPressure * initialPressure * 0.3) * (1 - Math.exp(-time / 10));
                    data.push(pressureSquared);
                });
            }
            return data;
        }

        function generatePerrineData(oilRate, initialPressure, gor, wor, testType) {
            const data = [];
            const times = [0.1, 0.2, 0.5, 1, 2, 5, 10, 20, 50, 100];
            if (testType === 0) { // Drawdown
                times.forEach(time => {
                    const pressure = initialPressure - (oilRate * (1 + 0.1 * gor/1000) * (1 + 0.2 * wor)) * Math.log10(time + 0.1) * 50;
                    data.push(Math.max(pressure, 0));
                });
            } else { // Buildup
                times.forEach(time => {
                    const pressure = initialPressure * 0.8 + (initialPressure * 0.2) * (1 - Math.exp(-time / 10));
                    data.push(pressure);
                });
            }
            return data;
        }

        function updateTestChart(chart, oilRate, initialPressure, gor, wor, testType) {
            chart.data.datasets[0].data = generateTestData(oilRate, initialPressure, gor, wor, testType);
            chart.data.datasets[1].data = generatePerrineData(oilRate, initialPressure, gor, wor, testType);
            chart.update();
        }

        function updateResultsTable(oilRate, initialPressure, gor, wor, testType) {
            const actualKo = 50 * (1 - (initialPressure - 2000) / 6000);
            const actualKg = 10 * (gor / 1000);
            const actualSkin = 2 + (oilRate / 500);
            const perrineKo = actualKo * 0.85;
            const perrineKg = actualKg * 0.9;
            const perrineSkin = actualSkin * 1.2;
            const p2Ko = actualKo * 0.98;
            const p2Kg = actualKg * 1.02;
            const p2Skin = actualSkin * 1.05;
            document.getElementById('actual-ko').textContent = actualKo.toFixed(2);
            document.getElementById('actual-kg').textContent = actualKg.toFixed(2);
            document.getElementById('actual-skin').textContent = actualSkin.toFixed(2);
            document.getElementById('perrine-ko').textContent = perrineKo.toFixed(2);
            document.getElementById('perrine-kg').textContent = perrineKg.toFixed(2);
            document.getElementById('perrine-skin').textContent = perrineSkin.toFixed(2);
            document.getElementById('p2-ko').textContent = p2Ko.toFixed(2);
            document.getElementById('p2-kg').textContent = p2Kg.toFixed(2);
            document.getElementById('p2-skin').textContent = p2Skin.toFixed(2);
        }

        // --- INITIALIZATION ---
        function initializePage() {
            // Tab listeners
            document.querySelectorAll('#blog-viewer .tabs .tab').forEach(tab => {
                tab.addEventListener('click', (event) => {
                    const tabName = event.currentTarget.getAttribute('data-tab');
                    if (tabName) {
                        openTab(event, tabName);
                    }
                });
            });

            // Chart setup
            const ctxLinearity = document.getElementById('linearityChart').getContext('2d');
            const linearityChart = new Chart(ctxLinearity, {
                type: 'scatter',
                data: { datasets: [{ label: 'ko/(μo*Bo) vs Pressure', data: generateLinearityData(0.5, 3000), backgroundColor: 'rgba(52, 152, 219, 0.7)', borderColor: 'rgba(52, 152, 219, 1)', showLine: true }]},
                options: { responsive: true, scales: { x: { title: { display: true, text: 'Pressure (psi)'}}, y: { title: { display: true, text: 'ko/(μo*Bo)'}}}} 
            });

            const ctxTest = document.getElementById('testAnalysisChart').getContext('2d');
            const testChart = new Chart(ctxTest, {
                type: 'line',
                data: {
                    labels: [0.1, 0.2, 0.5, 1, 2, 5, 10, 20, 50, 100],
                    datasets: [
                        { label: 'p² vs log(t)', data: generateTestData(500, 3500, 1000, 0.5, 0), borderColor: 'rgba(52, 152, 219, 1)', backgroundColor: 'rgba(52, 152, 219, 0.1)', fill: true },
                        { label: 'p vs log(t)', data: generatePerrineData(500, 3500, 1000, 0.5, 0), borderColor: 'rgba(231, 76, 60, 1)', backgroundColor: 'rgba(231, 76, 60, 0.1)', fill: true }
                    ]
                },
                options: { responsive: true, scales: { x: { type: 'logarithmic', title: { display: true, text: 'Time (hours)'}}, y: { title: { display: true, text: 'Pressure / Pressure²'}}}} 
            });

            // Slider listeners
            document.getElementById('volatility').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                document.getElementById('volatility-value').textContent = value.toFixed(1);
                updateLinearityChart(linearityChart, value, parseInt(document.getElementById('pressure-range').value));
            });
            document.getElementById('pressure-range').addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                document.getElementById('pressure-range-value').textContent = value;
                updateLinearityChart(linearityChart, parseFloat(document.getElementById('volatility').value), value);
            });

            const testSliders = ['oil-rate', 'initial-pressure', 'gas-oil-ratio', 'water-oil-ratio', 'test-type'];
            testSliders.forEach(id => {
                document.getElementById(id).addEventListener('input', () => {
                    const values = {
                        oilRate: parseInt(document.getElementById('oil-rate').value),
                        initialPressure: parseInt(document.getElementById('initial-pressure').value),
                        gor: parseInt(document.getElementById('gas-oil-ratio').value),
                        wor: parseFloat(document.getElementById('water-oil-ratio').value),
                        testType: parseInt(document.getElementById('test-type').value)
                    };
                    document.getElementById('oil-rate-value').textContent = values.oilRate;
                    document.getElementById('initial-pressure-value').textContent = values.initialPressure;
                    document.getElementById('gas-oil-ratio-value').textContent = values.gor;
                    document.getElementById('water-oil-ratio-value').textContent = values.wor.toFixed(1);
                    document.getElementById('test-type-value').textContent = values.testType === 0 ? 'Drawdown' : 'Buildup';
                    updateTestChart(testChart, values.oilRate, values.initialPressure, values.gor, values.wor, values.testType);
                    updateResultsTable(values.oilRate, values.initialPressure, values.gor, values.wor, values.testType);
                });
            });

            // Game listeners
            document.querySelectorAll('#game-options button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const answer = parseInt(e.target.id.replace('option', ''));
                    checkAnswer(answer);
                });
            });

            // Initial state
            updateResultsTable(500, 3500, 1000, 0.5, 0);
        }

        // --- EXECUTION ---
        // This will be called by the main page's script loader.
        document.addEventListener('DOMContentLoaded', function() { 
            initializePage(); 
        });
    </script>
</body>
</html>